{"version":3,"sources":["../../js/views.js"],"names":["$","Drupal","drupalSettings","behaviors","weaver_views","getOffsetTop","element","offsetTop","offsetParent","attach","context","settings","weaver","queryArrayToString","args","queryString","each","name","value","encodeURIComponent","slice","scrollToSearchResults","viewClass","searchResults","document","querySelector","searchQuery","window","location","search","searchScrollTarget","setTimeout","scrollTo","ajaxComplete","event","xhr","query","ajaxParams","parseQueryString","caView","decisionsGroupingLinks","querySelectorAll","forEach","groupingLink","existingUrl","href","newUrl","pos","indexOf","existingQuery","substring","replace","finalUrl","setAttribute","decisionsView","decisionsYearField","year","target","activeElement","classList","contains","pairs","split","pair","key","i","decodeURIComponent","inArrayCheck","inArray","test","push","jQuery"],"mappings":"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","sourcesContent":["(function ($, Drupal, drupalSettings) {\n\n  'use strict';\n\n  Drupal.behaviors.weaver_views = {\n\n\t\tgetOffsetTop: function(element) {\n\t\t  let offsetTop = 0;\n\t\t  while(element) {\n\t\t    offsetTop += element.offsetTop;\n\t\t    element = element.offsetParent;\n\t\t  }\n\t\t  return offsetTop - 120;\n\t\t},\n\n    attach: function (context, settings) {\n\n      const weaver = Drupal.behaviors.weaver_views;\n\n\t  const queryArrayToString = function(args) {\n\t\t  \tlet queryString = '';\n\t\t    $.each(args, function (name, value) {\n\t\t    \tqueryString = queryString + name + '=' + encodeURIComponent(value) + '&';\n\t\t    });\n\n\t      return queryString.slice(0, -1);\n\t\t  };\n\n\t\t  const scrollToSearchResults = function(viewClass) {\n\t      let searchResults = document.querySelector(viewClass);\n\t      if (searchResults) {\n\t        let searchQuery = window.location.search;\n\t        \n\t        // if a search query is present, scroll to results\n\t        if (searchQuery) {\n\n            let searchScrollTarget = searchResults.querySelector('.view-content') ? searchResults.querySelector('.view-content') : searchResults.querySelector('.view-empty');\n            if (searchResults.querySelector('.view-results-summary')) {\n              searchScrollTarget = searchResults.querySelector('.view-results-summary');\n              // stops overlap with Drupal's scroll event\n\t            setTimeout(() => {\n\t            \twindow.scrollTo(0, Drupal.behaviors.weaver_views.getOffsetTop(searchScrollTarget));\n\t            }, 500);\n            }\n\t        }\n\t      }\n\t    };\n\n      ///////////////////////////////////////\n      // SEARCH\n      // auto scroll to results if there are some\n\n      // ensures javascript runs only once per page load and not with every ajax call\n      // $('body', context).once('weaver_accordions').each(function () {\n        // SEARCH RESULTS\n        scrollToSearchResults('.lrb-search-view');\n      // });\n\n      // runs every ajax call\n      $(document).ajaxComplete(function (event, xhr, settings) {\n\n        // get current parameters\n        let query = window.location.search;\n\n      \t// get parameters from Ajax\n      \tlet ajaxParams = parseQueryString(query);\n\n      \t// COLLECTIVE AGREEMENTS\n      \t// update grouping options when form submitted\n        var caView = document.querySelector('.view-lrb-collective-agreements');\n\n        if (caView) {\n          \n          let decisionsGroupingLinks = document.querySelectorAll('.view-grouping-options a');\n        \t\n        \tif (ajaxParams && decisionsGroupingLinks) {\n\n            // add new parameters to the grouping options\n          \tdecisionsGroupingLinks.forEach((groupingLink) => {\n          \t\t// remove existing parameters\n          \t\tlet existingUrl = groupingLink.href;\n          \t\tlet newUrl = existingUrl;\n          \t\tlet pos = existingUrl.indexOf('?');\n\n\t\t\t\t\t    if (pos != -1) {\n\t\t\t\t\t      let existingQuery = existingUrl.substring(pos + 1);\n\t\t\t\t\t\t   \tnewUrl = existingUrl.replace(existingQuery, '');\n\t\t\t\t\t    }\n\n          \t\tlet queryString = queryArrayToString(ajaxParams);\n\t\t\t\t\t\t\tlet finalUrl = newUrl + queryString;\n\n\t\t\t\t\t\t\tgroupingLink.setAttribute('href', finalUrl);\n          \t});\n          }            \n        }\n\n        // DECISIONS\n        // make sure year field stays set\n        var decisionsView = document.querySelector('.view-lrb-decisions');\n\n        if (decisionsView) {\n        \tlet decisionsYearField = document.querySelector('.year-replace');\n        \tif (ajaxParams.year && ajaxParams.year != '') {\n        \t\tdecisionsYearField.value = ajaxParams.year;\n        \t}\n        }\n\n        // ALL SEARCH-STYLE RESULTS\n        if (event.target.activeElement.classList.contains('form-autocomplete') == false) {\n        \tscrollToSearchResults('.lrb-search-view');\n        }\n\n      });\n\n\t\t  var parseQueryString = function (query) {\n\t\t    var args = {};\n\t\t    var pos = query.indexOf('?');\n\t\t    if (pos != -1) {\n\t\t      query = query.substring(pos + 1);\n\t\t    }\n\t\t    var pairs = query.split('&');\n\t\t    var pair, key, value;\n\t\t    for (var i in pairs) {\n\t\t      if (typeof(pairs[i]) == 'string') {\n\t\t        pair = pairs[i].split('=');\n\t\t        // Ignore the 'q' path argument, if present.\n\t\t        if (pair[0] != 'q' && pair[1]) {\n\t\t          key = decodeURIComponent(pair[0].replace(/\\+/g, ' '));\n\t\t          value = decodeURIComponent(pair[1].replace(/\\+/g, ' '));\n\t\t          // Field name ends with [], it's multivalues.\n\t\t          let inArrayCheck = $.inArray(value, args[key]);\n\t\t          if (/\\[\\]$/.test(key)) {\n\t\t            if (!(key in args)) {\n\t\t              args[key] = [value];\n\t\t            }\n\t\t            // Don't duplicate values.\n\t\t            else if (inArrayCheck !== -1) {\n\t\t              args[key].push(value);\n\t\t            }\n\t\t          }\n\t\t          else {\n\t\t            args[key] = value;\n\t\t          }\n\t\t        }\n\t\t      }\n\t\t    }\n\t\t    return args;\n\t\t  };\n    }\n  };\n\n})(jQuery, Drupal, drupalSettings);\n"],"file":"views.js"}